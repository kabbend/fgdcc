
local loot = {

  ["comestible"] = {
	"viande rouge saignante",
	"agneau decoupe",
	"petit chaudron de soupe",
	"civet de lapin",
	"poule cuite",
	"enorme jambon",
	"bouquet d ail",
	"saucisson",
	"farine",
	"quelques oeufs",
	"poulet deplume",
	"deux canards deplumes",
	"chapelet de saucisses",
	"un sac de navets",
	"sac de pomme de terres",
	"six oeufs durs",
	"douze oeufs durs",
	"quignon de pain",
	"miche de pain",
	"terrine de porc",
	"pate de porc",
	"pain sec",
	"pain sec",
	"flasque d huile",
 	"huile",
	"petit recipient de sauce",
	"alcool fort",
	"petit baril d alcool",
	"fromage",
	"meule de fromage",
	"pommes",
	"sac de pommes",
	"pommes de terre",
	"petit sac de baies",
	"sac de sel",
	"petite boite de sel",
	"petit tonneau de biere",
	"tonneau de biere",
	"bouteille de vin rouge",
	"outre de vin rouge",
	"bouteille d hidromel",
	"bouteille d huile",
	"Paquet d epices rares",
	"poisson seche",
	"pain sec",
	"cereales",
	"fruits seches",
	"racines",
	"pois secs",
	"sac de lentilles",
	"saucissons",
	"viande faisandee",
	"viande salee",
	"jarre de fruit secs",
	"sac de fruit secs",
	"outre de biere",
	"outre de vin",
	"outre de vin",
	"outre de mauvais vin",
	"tonneau d eau",
	"sac d epis de mais",
	"sac de riz",
	"legumes secs",
	"legumes secs",
	"herbes comestibles",
	"tubercules",
	"tubercules",
	"champignons secs",
	"champignons secs",
	"poivre et condiments",
	"petit sac de poivre",
	"sac de the",
	"sac de the",
	"sac de graines",
	"sac de graines",
	"raisins",
	"viande sechee",
	"viande sechee",
	"viande sechee",
	"viande sechee",
	"viande sechee",
	"viande sechee",
	"fromage sec",
	"fromage sec",
	"gateaux secs",
	"gateaux secs",
	"jarre de vinaigre",
	"grosse bouteille de vin",
	"petite barrique de vin",
	"grosse barrique de biere",
	"grosse barrique de biere",
	"tubercules",
		},

  ["mundane"] = {
	"sablier",
	"statuette d un dieu inconnu",
	"reliques goblines",
	"cage a oiseaux, vide",
	"crane de gobelin",
	"crane orc",
	"crane humain",
	"pelle",
	"pelle",
	"pioche",
	"pioche",
	"bon tabac",
	"petit livre de recettes",
	"petite chaine en argent",
	"jeu de cartes",
	"plusieurs des en os",
	"pantalons",
	"braies colorees",
	"cape de laine",
	"casque",
	"carquois et quelques fleches",
	"grosse boucle de ceinture",
	"marteau de guerre",
	"sac a dos",
	"sac a dos",
	"ceinturon de cuir",
	"ceinturon de cuir",
	"ceinturon de cuir",
	"fourchette en argent", 
	"vetements sales de petite taille", 
	"dague",
	"dague",
	"dague",
	"dague",
	"dague",
	"5 m de ficelle",
	"10 m de ficelle",
	"15 m de ficelle",
	"20 m de ficelle",
	"arc court",
	"arc court",
	"bandana de soie sale",
	"une epee",
	"une epee",
	"une epee longue",
	"une epee longue",
	"un petit marteau",
	"sachet de cheveux",
	"epee gobeline",
	"petit joyau",
	"bracelet d argent",
	"massue",
	"gantelets de maille",
	"gantelets de cuir",
	"cape de bonne qualite",
	"toge de ceremonie",
	"bottes sales",
	"bottes sales",
	"bottes de cuir neuves",
	"bottes de cuir neuves",
	"outre",
	"outre",
	"petite bague en argent",
	"petite bague en or",
	"lingot en argent",
	"casque elfique fendu",
	"arc elfique",
	"arc elfique",
	"marteau nain de bonne facture",
	"armure de cuir",
	"armure de cuir",
	"armure de cuir",
	"armure de cuir",
	"casque de cuir",
	"casque de cuir",
	"petit bouclier",
	"petit bouclier",
	"petit bouclier",
	"grand pavois",
	"grand pavois",
	"couverts en argent",
	"chapeau de menestrel",
	"harpe de voyage",
	"rapiere",
	"gourmette en or",
	"paire de chaussettes chaudes",
	"paire de chaussettes chaudes",
	"canne a peche et hamecon",
	"parchemin vierge et plume",
	"pierre semi precieuse",
	"pierre semi precieuse",
	"petit pendentif",
	"petit pendentif",
	"anneau d une famille noble",
	"Fil et aiguille, morceaux de tissu",
	"Petit miroir d argent",
	"bougies",
	"bougies",
	"bougies",
	"boite en fer",
	"boite en fer",
	"10m de corde",
	"10m de corde",
	"pointes en fer",
	"piquets en bois",
	"petite boite en inox",
	"chapeau",
	"porte document en cuir",
	"petites piques",
	"bouteille d encre",
	"sacs",
	"batons d encens",
	"bandages",
	"bandages",
	"bandages",
	"belladonne",
	"haillons ensanglantes",
	"un de pipaute",
	"flasque d eau sanctifiee",
	"couteau pliant",
	"anneau d argent",
	"echarpe",
	"instruments de cuisine",
	"objets en ivoire",
	"feuilles de parchemin vierges",
	"fils de cuivre",
	"carte grossiere des environs",
	"haillons graisseux",
	"grand vetement de pluie",
	"couvertures",
	"scie",
	"petite quincaillerie",
	"sciseaux",
	"barre de fer",
	"pinces",
	"outre vide",
	"cape",
	"cape",
	"chapeau large de pluie",
	"chapeau large de pluie",
	"Flute",
	"clochette en argent",
	"gants de bonne facture",
	"gants de bonne facture",
	"rasoir",
	"flasque d acide",
	"herbe a pipe",
	"herbe a pipe",
	"pipe",
	"pipe",
	"bols de toutes tailles",
	"petit cristal",
	"eau de cologne",
	"pierre a aiguiser",
	"pierre a aiguiser",
	"peigne",
	"douzaine de clous",
	"douzaine de clous",
	"ficelle",
	"petit sac de molaires humaines",
	"du papier",
	"une petite lentille en verre",
	"bouchons de bouteille",
	"jouet d enfant",
	"cuilleres et fourchettes",
	"cuilleres et fourchettes",
	"assiettes ebrechees",
	"vieux vetements",
	"vieux vetements",
	"vieux vetements",
	"lanterne",
	"lanterne",
	"planches de bois",
	"marteau et clous",
	"marteau et clous",
	"marteau et clous",
	"pinceaux",
	"pierre a feu",
	"pierre a feu",
	"herbes medicinales",
	"vieux oreillers",
	"bottes",
	"sac de jute",
	"grappin",
	"maillet",
	"pots de terre",
	"petit chaudron",
	"petit chaudron",
	"petit bois",
	"petit bois",
	"petit bois",
	"hachette",
	"hachette",
	"couteau a viande",
	"couteau a viande",
	"feuille de boucher, rouillee",
	"petite boite en etain",
	"petite casserole",
	"paillasse",
	"vieux chiffons",
	"vieux chiffons",
	"gourdin",
	"gourdin cloute",
	"gros gourdin",
	"grosse masse de guerre",
	"javelot",
	"boulier",
	"petite balance de joaillier",
	"loupe",
		},

  ["potions"] = {
	"Antitoxine. Soigne n importe quel poison",
   	"Assassin Blood. DC 10 Stamina saving throw. On failed, takes 1d12 poison damage and poisoned 24 hours. On successful save, takes half damage and isn t poisoned",
  	"Crawler Mucus. harvested from a dead. DC 13 Stamina saving throw or be poisoned for 1d6 minutes. Paralyzed. Repeat saving throw each minute",
  	"Malice. DC 15 Const. saving throw or poisoned 1 hour. Blinded",
  	"Midnight Tears. No effect until midnight. If not neutralized before, DC 17 Const. saving throw, 4d6 poison damage on a failed save, or half as much damage on a successful one.",
	"Luck Potion, Gives you +1 on any roll, contains 3 doses. Consuming more than 1 dose in a row will cause a Magical Malady",
	"Spectre Touch Potion - You are able make sound and phase through objects but cannot interact with anything. roll STA on DC 15. Fail and suffer the attentions of a minor poltergeist for a day or two. At any time you may revert to natural form",
	"Invisibility Potion - vanish from sight for Level rounds, though magical sight may perceive you. May end effect at will, making attack, or upon losing consciousness.",
	"Gusty Draught, retain your form but can now move like the wind for your Level in minutes, allowing you to fluidly move around and through small spaces. Gain 5 hold, and use one hold for each unnaturally fluid movement you make.",
	"Potion of Featherfall - Reduces your weight to that of a feather, allowing you to jump and glide longer distances or land softly without a sound after falling. Lasts for one fall or jump.",
	"Enchanted Expunge, frees the consumer from a magical malady, but suppresses magical capability for 1d6 hours",
	"Liquid Lunch, sustains your body in lieu of actual food, but is unable to stop your stomach from growling",
	"Silver Frost, applied to a weapon or arrow, this mercurial potion affect first enemy struck, freezing the body part solid. Do not touch or drink",
	"Golden Snitch, golden metallic liquid renders unable to lie on failed PER DC 15 save",
	"Purple Haze, When flask is smashed, purple fog covers a 15 ft diameter dome making it difficult to see or breathe. Any creature within fog has -1 malus",
	"Alchemical Amplification, allows to raise your voice to a cacophonous volume for a minute or two, easily deafening those in closed spaces or near you. Then unable to speak until you rest and get something hot to drink",
	"Healing potion 1d4 HP",
	"Healing potion 1d4 HP",
	"Healing potion 1d4 HP",
	"Healing potion 1d4 HP",
	"Healing potion 1d4 HP",
	"Healing potion 1d4 HP",
	"Healing potion 1d4 HP",
	"Healing potion 1d6 HP",
	"Healing potion 2d4 HP",
	"Healing potion 2d4 HP",
	"Healing potion 2d4 HP",
	"Healing potion 2d4 HP",
	"Healing potion 2d4 HP",
	"Healing potion 2d4 HP",
	"Healing potion 2d4 HP",
	"Healing potion 2d4 HP",
	"Healing potion 1d8 HP",
	"Healing potion 1d8 HP",
	"Healing potion 1d8 HP",
	"Healing potion 1d8 HP",
	"Healing potion 1d8 HP",
	"Healing potion 1d8 HP",
	"Healing potion 1d8 HP",
	"Healing potion 1d8 HP",
	"Healing potion 1d8 HP",
	"Healing potion 1d10 HP",
	"Healing potion 1d10 HP",
	"Healing potion 1d10 HP",
	"Healing potion 1d10 HP",
	"Healing potion 1d10 HP",
	"Animal Control For 2d6 rounds, all mundane animals within 30  obey the imbiber commands, as follows: 1 or less HD = automatic; 2-4 HD = DC 16 Will save to resist; 5+ HD = DC 12 Will save to resist.",
	"Extraordinaty Healing Imbiber heals 4d6+3 hit points of damage immediately",
	"Fire resistance For 1d4 hours, imbiber resists first 10 points of fire or heat damage taken each round, and receives a +4 bonus to all saves to resist  re or heat-based effects.",
	"Giant strength Imbiber Strength increases such that he has a +8 attack/damage bonus, which lasts 2d6 rounds.",
	"Heroism For 1d6+1 turns, imbiber gains a +3 bonus to attacks, damage, saves, spell checks, and skill checks.",
	"Invisibility Imbiber turns invisible for 1d4+1 rounds. He returns to visibility if he attacks.",
	"Invulnerability Imbiber gains resistance to all damage of 6 points; resists the first 6 points of damage every round. gains 6 points of resistance to fire, electricity, and acid damage; +4 bonus to AC; +4 bonus to all saving throws. duration 1d6 rnds",
	"Poison (1d20+10 will determine poison DC to resist)",
	"Poison (1d20+10 will determine poison DC to resist)",
	"Poison (1d20+10 will determine poison DC to resist)",
	"Poison (1d20+10 will determine poison DC to resist)",
	"Poison (1d20+10 will determine poison DC to resist)",
	"Undead control For 2d6 turns, undead within 30 ft obey commands: 1 HD = automatic; 2-4 HD = DC 16 Will save to resist; 5+ HD = DC 12 Will save to resist.",
		},

  ["items"] = 	{
 "grand arc Elfe noir. +1 to hit dans l obscurite",
 "anneau de protection contre le feu (+1 contre tous les degats ou les jets de sauvegarde)",
 "anneau de protection contre le froid (+1 contre tous les degats ou les jets de sauvegarde)",
 "anneau de protection contre la maladie (+1 contre tous les degats ou les jets de sauvegarde)",
 "anneau du sorcier (+1 a tous les checks de sort, mais +1 egalement en cas de corruption ou de misfire)",
 "baton de sorcier (+1 a tous les checks de sort, mais perte definitive de 1d8 points de vie si perdu ou brise)",
 "Epee de gel. +1d6 de degats de froid. Difficile a tenir ou manier quand elle inflique des degats (-1, puis -2 etc. a chaque fois dans un combat)",
 "ecaille de dragon (500-800 gp)",
 "belles pieces de ceramique (600-1000 gp)",
 "pieces de monnaies ancestrales (600-800 gp)",
 "minerai d adamantine pur (3000-4000 gp)",
 "minerai de mithril pur (2000-2500 gp)",
 "cartes astrologiques de grande precision (200-400 gp)",
 "Epee Andar is hard and durable, yielding translucent gems that flash green-red or brown-red when properly faceted (500 gp)",
 "A round translucent white gemstone with a ring of striped brown through its center (250 gp)",
 "A newly crafted barrel filled with iron nails. Might be difficult for the players to get this around if they don t have a cart (500 gp)",
 "This simple agate gem has translucent circles of white dotted around its surface which bring to mind the image of an eye (200 gp)",
 "A small Azurite gem. It is opaque and a deep mottled blue in colour (800 gp)",
 "A small gold bracelet. It s design is plain so as to be appropriate for anyone (350 gp)",
 "Whenever an arrow is fired in the vicinity of this amulet s wearer, it will strike the amulet wearer",
 "This amulet is a golden disk on a chain. It usually bears the image of a lion or other powerful animal (STA +5 max 18, 4000 gp)",
 "A dirty canvas bag containing twenty pounds of an aphrodisiac root (200 gp)",
 "Aquamarine is a hard, transparent form of beryl, blue-green in colour. These sought after gems are found primarily among the tribes that roam the tundra (800 gp)",
 "This is a set of Studded Leather Armour that has been enchanted with the spirit of a long dead barbarian warrior. Once per day it allows the user to channel it's rageful spirit (+3 Attack, +3 damage during 1 fight)",
 "A dark blue-black Pearl (500 gp)",
 "A silver ring with a transparent blue-white sapphire (1000 gp)",
 "Crossbow bolt of chaos +6, 1d12 damage, but 1 random effect on hit (50 percent to inflict a random minor corruption on the target, and 50 percent on the wielder !)",
 "Hyperstone, Once per day this item grants one extra attack for its user",
 "An ornate golden music box (1000 gp)",
 "An obsidian statuette of a demon with a golden inlay and fittings (800 gp)",
 "This longsword seems to have been made more for show than for use. It is silver-plated steel and has a jet gemstone set inside the hilt (+ 2 damage, 1000 gp)",
 "A platinum bracelet set with a sapphire (2500 gp)",
 "A crown of severed, mummified fingers. Each finger bears three jeweled rings (2000 gp)",
 "A jeweled gold crown of superb quality (7500 gp)",
 "A small gold statuette of a man, set with rubies (5000 gp)",
 "Garnet is a general class of crystals ranging from deep red to violet in colour. a typical cut for this rare isometric gem is 12 to 24 sides, with the very rare 36 sides being known from time to time. This may be the only 48 sided garnet in existance. and as such it is highly prized.",
 "This warhammer belonged to a famous dwarven general known as Thaxton the Fierce. It grants a +1 bonus to attack and damage rolls, as well as Intimidation checks, to the user. If the user is a dwarf, this bonus is increased to +2.",
 "A quarry of 20 Screaming Arrows – intimidate/fear check (Personality check vs attack check)",
 "chain armor, Grants the following, +2 fort saves, +2 reflex saves, +2 will saves",
 "ill fated necklace, The wearer of this necklace has a general feeling that he is safe. The opposite is, in fact, the case. Any time something bad happens to the group, the wearer of this necklace bears the brunt of the misfortune",
 "While wearing this amulet, you are hidden from divination magic. You can't be targeted by such magic or perceived through magical scrying sensors. ",
 "A small box of turquoise animal figurines (200 gp)",
 "A very large scroll tube containing the plans for many of the ancient war engines of Armentarious (300 gp)",
 "A famous battle banner, long lost, smells badly (300 gp)",
 "An old bronze crown, once inlaid with gemstones. They have since been picked out, but the crown itself is wonderfully cast (180 gp)",
 "A large, boxed chess set. All the pieces are small, dead pixies somehow sealed within glass (150 gp)",
 "An ancient deck of cards with five suits – clovers, swords, clubs, hearts, and dragons (150 gp)",
 "A carved sculpture of jungle animals on an ivory tusk (200 gp)",
 "A set of dies and hammers for minting the king's coinage (400 gp)",
 "lingot de mithril (1000 gp)",
 "A large, well-made tapestry depicting a local duke (250 gp)",
 "A long silk robe with golden embroidery (250 gp)",
 "Demonic themed tarot/playing cards – extra planar repercussions based on game played; tarot tales come true",
 "This dwarf war mask has been painted gold and appears to be a ceremonial mask worn to battle (700 gp)",
 "Companion rings, Two rings, user may opt to take damage for the other person wearing the ring (1000 gp)",
 "Armure renforcee par de l Adamantine, une des substances les plus dures qui existe. Tous les critiques tires contre le porteur ont un malus de -5. Par contre le porteur a un malus de -1 a tous ses checks",
 "Amulette de vie. Donne +2 HP temporaires (tant que l objet est porte)",
 "Amulette sanctifiee. Donne +4 HP temporaires (tant que l objet est porte) a un porteur d alignement Loyal",
 "Amulette sacree. Donne +4 HP temporaires (tant que l objet est porte) a un porteur d alignement Neutre",
 "Amulette sacree. Donne +4 HP temporaires (tant que l objet est porte) a un porteur d alignement Neutre",
 "Amulette sacree. Donne +4 HP temporaires (tant que l objet est porte) a un porteur d alignement Neutre",
 "Amulette du chaos. Donne +4 HP temporaires (tant que l objet est porte) a un porteur d alignement Chaotique",
 "Amulette du chaos. Donne +4 HP temporaires (tant que l objet est porte) a un porteur d alignement Chaotique",
 "Piece d armure + 1 AC, mais lourde (-1 a tous les checks impliquant mouvement ou vitesse en dehors du combat)",
 "Piece d armure + 1 AC, mais lourde (-1 a tous les checks impliquant mouvement ou vitesse en dehors du combat)",
 "Piece d armure + 1 AC, mais lourde (-1 a tous les checks impliquant mouvement ou vitesse en dehors du combat)",
 "Piece d armure + 1 AC, elfique et legere",
 "Piece d armure + 1 AC, elfique et legere",
 "Piece d armure + 1 AC, naine",
 "Piece d armure + 1 AC, naine",
 "Piece d armure + 1 AC, runique, des peuples du Nord",
 "Piece d armure + 2 AC",
 "1d6 fleches engravees, +1 to hit",
 "1d6 fleches engravees, +1 to hit",
 "1d6 fleches engravees, +1 to hit",
 "1d6 fleches engravees, +1 to hit, +1 au degats",
 "Lance sacree, +2 to hit",
 "Epee tueuse de goblins, elfique, +1 au degats contre les Gobelins",
 "Epee tueuse de goblins, elfique, +1d4 au degats contre les Gobelins",
 "Epee tueuse d Orcs, naine, +1d4 au degats contre les Orcs",
 "Marteau tueur de Troll, nain, +1d8 au degats contre les Trolls. 2 Mains et particulierement lourd.",
 "Ceinture naine, +1 AC",
 "Ceinture elfe, +1 AC et +1 Personality",
 "Ceinture de geant +1 FOR (+1 melee et +1 degats)",
 "Cape de protection +1 aux jets de discretion, rend pratiquement invisible dans le noir tant que l on reste immobile",
 "Cape de protection +1 AC contre les projectiles non magiques (pas en melee)",
 "bottes elfiques While you wear these boots, your steps make no sound, regardless of the surface you are moving across. You also have advantage on Dexterity checks that rely on moving silently.",
 "brassard d'archer While wearing these bracers, you gain a +1 bonus to damage rolls on ranged attacks made with such weapons.",
 "broche de protection. En portant cette broche, immunite contre les attaques de magic missile",
 "Fleches d Acheron Fabriquees dans l obscurite par un artisan aveugle, ces fleches peuvent trouver leur cible même dans les tenebres les plus profondes.  Un archer peut les tirer dans le noir, sur de faire mouche les yeux bandes d un epais tissu (+8 to hit). Cependant, si jamais la lumiere du soleil venait a toucher ces fleches, celles-ci se disperseraient comme ombre ou poussiere.",
 "Hache du Roi-Conquerant Elle est faite d acier etincelant, brillant d une lumiere doree et est dotee du mythique pouvoir d autorite. Lorsque vous portez la hache, vous devenez un phare d inspiration pour tous ceux que vous commandez. Toutes les recrues a votre service ont +1 loyaute, peu importent vos qualites de chef.",
"La Lance de Carcosa Lance Personne ne sait d où provient cette pointe tordue de corail blanc. Ceux qui la portent trop longtemps ont l esprit encombre de rêves bizarres et se mettent a percevoir les pensees etranges des Autres. Nul n est a l abri. Utilise contre toute cible « naturelle » (humains, gobelins, hibours, etc.) la Lance agit comme une simple lance. Sa vraie nature est de blesser ces choses que leur nature etrange protege des armes ordinaires. Utilisee ainsi, la Lance peut blesser des adversaires invulnerables. Le porteur discernera ses ennemis des qu il les verra. La Fleche reconnait les siens.",
"La lentille d Epoch Un archimage, trop vieux et faible pour quitter sa tour, conçut ce dispositif complexe et fragile de verre et d or afin de contempler les antiquites et les reliques qu il aimait tant. Regarder un objet a travers la lentille procure des visions sur son auteur et son origine.",
"Flacon de Souffle Une chose simple mais utile lorsque vous avez besoin d une bouffee d air frais. Le flacon semble vide, mais ne peut pas être rempli. Tout ce qui y est ajoute deborde simplement car le flacon est eternellement plein d air. S il est place sous l eau, il produira des bulles sans arret. On peut respirer normalement lorsqu on le porte a la bouche",
"Armure de Timunn +1 AC, Cette armure discrete, qui se fond avec les vêtements, apparaît differemment a chacun. Le porteur semble toujours au dernier cri de la mode pour tous ceux qui le regardent.",
"Suif de Verite de Titus C est une bougie de suif aux couleurs d ivoire et de cuivre avec une meche d argent tresse.  Lorsqu elle est allumee, ceux qu elle eclaire sont incapables de mentir. Ils peuvent garder le silence ou simuler, mais lorsqu on leur pose une question directe, ils ne peuvent que dire la verite.",
"Epee Vorpale +2. Plus tranchante que tout, cette lame d apparence simple est vouee a separer une chose de l autre, le membre d un corps ou les gens de leur vie. Quand vous infligez des degats Critiques avec l Epee Vorpale, votre ennemi doit choisir quelque chose (un objet, un avantage, un membre) et le perdre. Sur un Fumble, faites de meme mais sur votre allie le plus proche, ou vous meme a defaut, et c'est l'epee qui choisit.",
"Scroll level 1 spell",
"Scroll level 1 spell",
"Scroll level 1 spell",
"Scroll level 1 spell",
"Scroll level 1 spell",
"Scroll level 1 spell",
"Scroll level 1 spell",
"Scroll level 1 spell",
"Scroll level 1 spell",
"Scroll level 1 spell",
"Scroll level 1 spell",
"Scroll level 1 spell",
"Scroll level 1 spell",
"Scroll level 1 spell",
"Scroll level 1 spell",
"Scroll level 1 spell",
"Scroll level 2 spell",
"Scroll level 1 spell",
"Scroll level 1 spell",
"Scroll level 1 spell",
"Scroll level 2 spell",
"Scroll level 2 spell",
"Scroll level 2 spell",
"Scroll level 2 spell",
"Scroll level 2 spell",
"Scroll level 2 spell",
"Scroll level 2 spell",
"Scroll level 2 spell",
"Scroll level 2 spell",
"Scroll level 2 spell",
"Scroll level 2 spell",
"Scroll level 2 spell",
"Scroll level 2 spell",
"Scroll level 2 spell",
"Scroll level 2 spell",
"Scroll level 3 spell",
"Scroll level 3 spell",
"Scroll level 3 spell",
"Scroll level 3 spell",
"Scroll level 3 spell",
"Scroll level 4 spell",
"Scroll level 4 spell",
"Scroll level 5 spell",
		},
	};


function onInit()
        Comm.registerSlashHandler("loot", slashCommandHandlerLoot);
end

function mysplit(inputstr, sep)
                        if sep == nil then sep = "%s" end
                                local t={}
                                for str in string.gmatch(inputstr, "([^"..sep.."]+)") do
                                table.insert(t, str)
                                end
                                return t
                        end

-- return the name of a random wizard spell, for a given level (1-5)
function rollScroll(level)

	local eligible = {};
	local child = DB.getChildrenGlobal(  "reference.spelldata@DCC RPG Spells" );
        for _,spell in ipairs(child) do
                local name = spell.getName();
                local lvl = DB.getValue( spell , "level" , 0 );
                local domain = DB.getValue( spell , "source" , "" );
                local general = DB.getValue( spell , "general" , "" );
                if (general ~= "") and (domain == "Wizard" ) and ( lvl == level ) then
			table.insert( eligible, name );
                end
        end
	if #eligible > 0 then
		return eligible[ math.random(#eligible) ];
	else
		return "";
	end	
end

-- return the name of a random loot item. if the item is a scroll,
-- choose a random spell
function rollItem()

  local item = loot["items"][math.random(#loot["items"])];
  if item == "Scroll level 1 spell" then
           return "Scroll level 1 - " .. rollScroll(1);
  elseif item == "Scroll level 2 spell" then
           return "Scroll level 2 - " .. rollScroll(2);
  elseif item == "Scroll level 3 spell" then
           return "Scroll level 3 - " .. rollScroll(3);
  elseif item == "Scroll level 4 spell" then
           return "Scroll level 4 - " .. rollScroll(4);
  elseif item == "Scroll level 5 spell" then
           return "Scroll level 5 - " .. rollScroll(5);
  end
  return item;

end


function slashCommandHandlerLoot(sCommand, sParams)

        -- parse params
        local args = mysplit( sParams );

        local aUsageMessage = { text = sCommand .. " low/med/high" , secret = true };

	if (#args > 1) then
                Comm.addChatMessage(aUsageMessage) ;
                return;
        end

	local value = "";
        if (not args) then
		value = "low" ;
	else
		value = args[1];
	end
	if value ~= "low" and value ~= "med" and value ~= "high" then value = "low"; end

	local howmany;
	local aMessage = { text = "" , secret = true };

	if value == "low" then

		local count = 0;

		-- 3-4 comestible
		howmany = math.random(2) + 2;
		for i=1,howmany do
			count = count + 1;
			local index = math.random(#loot["comestible"]);
			aMessage.text = aMessage.text .. count .. ". (c) " .. loot["comestible"][index] .. "\n";
		end

		-- 2-3 mundane items
		howmany = math.random(2) + 1;
		for i=1,howmany do
			count = count + 1;
			local index = math.random(#loot["mundane"]);
			aMessage.text = aMessage.text .. count .. ". (m) " .. loot["mundane"][index] .. "\n";
		end

 		-- a dozen of gold
		aMessage.text = aMessage.text .. (count+1) .. ". (g) " .. math.random(12) .. " GP coins\n";

		-- 15% chance to get a potion
		local chance = math.random(100);
		local index = math.random(#loot["potions"]);
		if chance <= 15 then
			aMessage.text = aMessage.text .. (count+2) .. ". (p) " .. loot["potions"][index] .. "\n";
		end
	
		-- 1% chance to get an item
		chance = math.random(100);
		if chance == 1 then
			aMessage.text = aMessage.text .. (count+3) .. ". (i) " .. rollItem() .. "\n";
		end
	
	elseif value == "med" then
		
		local count = 0;

		-- 1-2 comestible
		howmany = math.random(2);
		for i=1,howmany do
			count = count + 1;
			local index = math.random(#loot["comestible"]);
			aMessage.text = aMessage.text .. count .. ". (c) " .. loot["comestible"][index] .. "\n";
		end

		-- 2-3 mundane items
		howmany = math.random(2) + 1;
		for i=1,howmany do
			count = count + 1;
			local index = math.random(#loot["mundane"]);
			aMessage.text = aMessage.text .. count .. ". (m) " .. loot["mundane"][index] .. "\n";
		end

 		-- a hundred of gold
		count = count + 1;
		aMessage.text = aMessage.text .. count .. ". (g) " .. math.random(120) .. " GP coins\n";

		-- 1-2 potion
		howmany = math.random(2);
		for i=1,howmany do
			count = count + 1;
			local index = math.random(#loot["potions"]);
			aMessage.text = aMessage.text .. count .. ". (p) " .. loot["potions"][index] .. "\n";
		end
	
		-- 15% chance to get an item
		local chance = math.random(100);
		if chance <= 15 then
			aMessage.text = aMessage.text .. (count+1) .. ". (i) " .. rollItem() .. "\n";
		end
	
	elseif value == "high" then

		local count = 0;

		-- no comestible
		-- 3-4 mundane items
		howmany = math.random(2) + 2;
		for i=1,howmany do
			count = count + 1;
			local index = math.random(#loot["mundane"]);
			aMessage.text = aMessage.text .. count .. ". (m) " .. loot["mundane"][index] .. "\n";
		end

 		-- a thousand of gold
		count = count + 1;
		aMessage.text = aMessage.text .. count .. ". (g) " .. math.random(1200) .. " GP coins\n";

		-- 2-3 potions
		howmany = math.random(2)+1;
		for i=1,howmany do
			count = count + 1;
			local index = math.random(#loot["potions"]);
			aMessage.text = aMessage.text .. count .. ". (p) " .. loot["potions"][index] .. "\n";
		end
	
		-- 1 item
		aMessage.text = aMessage.text .. (count+1) .. ". (i) " .. rollItem() .. "\n";

		-- 15% chance to get another item
		local chance = math.random(100);
		if chance <= 15 then
			aMessage.text = aMessage.text .. (count+2) .. ". (i) " .. rollItem() .. "\n";
		end
	
	end

        Comm.addChatMessage(aMessage) ;
	
end


